第四章 条件测试和判断语句
=======================

## 1.条件测试

### 1.条件测试基本语法

用户使用条件测试语句来测试指定的条件表达式的条件的真或者假。

当指定的条件为真时，整个条件的返回值为**0**。

反之，如果指定的条件为假时，则条件测试语句的返回值为非零值。

**注意**：这与C/C++中的条件测试的返回值不一样。

Shell这样做的原因是为了保持与Shell程序的退出状态一致：当某个Shell程序成功执行后，该进程会返回一个0值，而如果该程序执行错误，则会返回一个非0值。

条件测试的语法有两种：
* test命令
* [命令

**test命令**：
在大部分Shell命令中，test都是作为一个内部命令出现的。如果没有指定绝对路径，则使用的都是内部命令。

test命令的语法如下：

    test expression

参数expression表示需要进行测试的条件表达式，由字符串、整数、文件名，以及各种运算符组成。

**[命令**：
[命令的作用也是对后面的条件表达式进行测试，但是为了增加程序的可读性，Shell要求在条件表达式的后面追加一个右方括号]来与前面的[配对。

[命令的语法如下：

    [ expression ]

**注意**：命令和参数之间必须有一个空格，所以上面语法中，expression和左右两个方括号之间都有空格。


### 2.字符串测试

字符串运算符

|运算符|说明|
---------|-------|
|string|判断指定的字符串是否为空|
| =      |判断两个字符串是否相等|
| != |判断两个字符串是否不相等|
|-n|判断字符串是否是非空串|
|-z|判断字符串是否是空串|

**注意**：对于第一种运算符，即单独给定一个字符串的形式，只能使用test来测试是否为空串，而不能使用方括号的方式来测试。

**注意**：运算符的左右两侧必须保留空格。

**注意**：在字符串比较时，用双引号将字符串界定起来是一个非常好的习惯。

### 3.整数测试

整数测试也有两种形式的语法：

    test number1 op number2
    或者
    [ number1 op number2 ]

number1和number2分别表示参与比较的两个整数，可以是**常量**或**变量**，op表示运算符。

## 常见的整数运算符
|运算符|说明|
---------|-------
|-eq|比较是否相等|
|-ne|比较是否不相等|
|-gt|比较是否number1大于number2|
|-lt|比较是否number1小于number2|
|-ge|测试number1是否大于等于number2|
|-le|测试number1是否小于等于number2|

**注意**：上面列出的运算符都仅仅是针对整数运算符的。

另外，字符串运算符和整数运算符不能混用。

### 4.文件测试

Shell提供了许多与文件有关的操作符，通过这些操作符，用户可以对文件的状态进行检测。

文件测试的语法如下：

    test op file
    或者
    [ op file]

文件操作符的功能主要有3个方面：
* 检测文件是否存在
* 检测文件的类型
* 检测文件的访问权限

##常用文件操作符

|操作符|说明|
--------|--------
|-a file|文件是否存在|
|-b file|文件是否存在，且为块文件|
|-c file|文件是否存在，且为字符文件|
|-d file|文件是否存在，且为目录|
|-e file|同-a flie|
|-s file|文件的长度是否为0，或者文件非空|
|-f file|文件是否存在，且为常规文件|
|-w file|文件是否存在，且可写|
|-r file|文件是否存在，且可读|
|-x file|文件是否存在，且可执行|
|-L file|文件是否存在，且为符号链接|
|-u file|文件是否设置suid位|


### 5.逻辑操作符

在Shell编程中，经常遇到同时判断多个条件的情况。

Shell中的逻辑操作符可以将多个不同的条件组合起来，从而构成一个复杂的条件表达式。

常用的逻辑操作符

|操作符|说明|
----------|------
|!expression|逻辑非|
|-a|逻辑与|
|-o|逻辑或|


## 2.条件判断语句

### 1.使用简单的if语句进行条件判断

语法如下：

    if expression
    then
        statement1
        statement2
        ……
    fi

expression通常代表一个条件表达式，也可以是一个**Shell命令**。因为每个Shell命令都会有一个退出状态码，可以用来作为命令是否正常退出的标志。

**还要注意**：在Shell中，0表示真，而非0表示假。这与其他语言相反。

另外，由于在Shell中并没有提供大括号{}来表示代码块，所以需要使用fi关键字来表示if结构的结束。

为了使得代码更加紧凑，在某些情况下，可以将if子句和then子句写在同一行中。此时，需要在expression表达式后面加上一个分号，如下：

    if expression; then
        statement1
        statement2
    fi

**Notes**：在使用if语句的时候，千万不能忘了在最后加上fi结束标识符。

分号的作用是表示子句已经结束。

**注意**：在Shell中，如果想要将多条命令放在同一行中，需要使用分号将其隔开。

**Notes**：在if语句中，如果使用条件表达式，可以使用test命令，也可以使用方括号[]

**tips**：在Shell程序中使用代码创建或者修改某个文件的时候，首先判断一下文件是否创建成功，或者判断文件是否存在是一个非常好的习惯。

在Shell中，有一个特殊的命令，被称为**空命令**。其表示方法是一个冒号“:"，该命令不做任何事情，但是它的退出状态永远是0。

**一个骚操作**：用&&来替代if语句，语法如下：

    test "$(whomai)" != "root" && (echo you are using a non-previleged account; exit 1)

如果前面的test测试为真，则执行后面的括号中的语句。

### 2.使用if-else语句进行流程控制

if else语句的基本语法如下：

    if expression
    then 
        statement1
        statement2
        ……
    else
        statement3
        ……
    fi

if-else不仅可以简单的处理两个分支的情况，还可以通过嵌套处理多个分支的情况。

### 3.使用if elif语句进行多条判断

基本语法如下：

    if expression1
    then
        statement1
        statement2
        ……
    elif expression2
    then
        statement3
        statement4
        ……
    elif expression3
    then
        statement5
        statement6
        ……
    else
        statement
    fi

### 4. 使用exit语句退出程序

在Shell程序执行的过程中，有时用户可能需要在满足某个条件的时候退出程序的执行。

可以通过if配合exit语句来实现。

exit语句的基本功能是终止Shell程序的执行。

另外，exit语句还带一个可选的参数，用来指定程序退出时的状态码。

基本语句如下：

    exit status

status表示退出状态，该参数是一个整数值，其取值范围是0-255。（通常情况下，每个数值都有特定的含义）

与Shell的命令一样，Shell程序退出的状态也存储在系统变量$?中，因此，用户可以通过该变量取得Shell程序返回给父进程的退出状态码。

如果没有参数给exit语句，则脚本的退出状态码就由脚本中最后执行的语句来决定，即exit语句之前的那条语句。

这些退出状态码可以提供给其他程序，使得其他程序能够按照该状态码做出相应的操作。

## 3.多条件判断语句case

Shell也提供了一个专门处理多分支情况的语句，即case语句。通过使用case语句，可以使得程序更加有条理性。

case语句的基本语法如下：

    case variable in
    value1)
        statement1
        ……
        statementN;;
    valule2)
        statement1
        ……
        statementN;;
    ……
    vauleN)
        statement1
        ……
        statementN;;
    *)
        statement1
        ……
        statementN;;
esac


variable是一个变量，case语句会将变量的值与value1—valueN中的每个值进行比较，如果与某个value相等，则执行该value后的一组语句。

当遇到;;符号时，就跳出case语句，执行esac语句后面的语句。

如果没有一个值与variable匹配，则执行*后面的那一组语句。

**Notes**：
* 对于变量名variable，可以使用双引号，也可以不用
* 每个case子句中的条件测试部分，都以右括号)结束
* 每个case子句都以一对分号;;结束

case语句的典型作用：

* 使用case语句来处理选项参数
* 使用case语句来处理用户多种不同的输入

## 4.运算符

Shell中的运算符有：
* 字符串运算符
* 数值运算符
* 文件运算符
* 算术运算符
* 位运算符
* 自增\自减运算符

前三个在之前的小节中已经学习过了。

### 1.算术运算符

## 常用算术运算符及其用法

|运算符|说明|举例|
---------|------|--------
|+|求2个数的和|例如1+5是求1和5的和|
|-|求2个数的差|例如9-3是求9和3的差|
|\*|求2个数的乘积|例如2*4是求2和4的乘积|
|/|求2个数的商|例如28/4是求28除以4的商|
|%|求余|例如23%4是求23除以4后的余数|
|\*\*|幂运算|例如3\*\*3是求3³的值|

在Linux Shell中，用户可以通过4中方式来执行算术运算。

#### (1)使用expr外部程序

expr是一个Shell命令，可以计算某个表达式的值。

基本语法如下：

    expr expression

其中，expression是要计算的表达式

使用expr时的注意事项：
* 运算符左右两边必须要有**空格**
* expr命令不能计算幂运算
* 要使用反单引号将表达式括起来
* 括号和乘法运算符一定要进行**转义**

例如：

    result=`expr 2 - 100`
    result=`expr 2 \* 5`
    result=`expr \( 2 - 6 \) \* 12`

#### (2)使用$((…))

使用这种形式写法比较自由，无需对运算符和括号做转义处理，可以采用松散或者紧凑的格式来书写表达式。

例如：

    result=$((3+6))
    result=$(( 3 + 9 ))
    result=$(( 3 * 6 ))       可以看到，乘法运算符不用加转义字符
    result=$(( (1-4)*5 ))     可以看到，括号也不用加转义字符

#### (3)使用$[…]

这种语法的特点和使用两个圆括号相同，算术表达式中的乘号和括号也不用加转义符号。

#### (4)使用let命令

使用let命令可以执行**一个或者多个**算术表达式，其中的变量名无需使用$符号。

如果表达式中含有**空格**或者其他特殊字符，则必须将其引用起来。

例如：

    n=10
    let n=n+1
    let n=n*10
    let n=n**2

#### 复合运算符

##复合算术运算符

|运算符| 说明 |举例|
---------|------|-------
|+=|将左边的数加上右边的数，再将和赋给左边的变量|3+=5等于8|
|-=|将左边的数减去右边的数，再将差赋给右边的变量|5-=2等于3|
|\*=|将左边的数乘以右边的数，再将积赋给左边的变量|5\*2等于10|
|/=|将左边的数除以右边的数，再将商赋给左边的变量|6\=3等于2|
|%=|将左边的数对右边的数求模，再赋给左边的变量|22%=3等于1|

### 2.位运算符

## 常用位运算符

|运算符|说明|举例|
---------|------|-------
|<<|左移|4<<2将4左移2位|
|>>|右移|8>>2将8右移2位|
|&|按位与|8&4，将8和4的二进制形式按位相与|
|\||按位或|8\|4，将8和4的二进制形式按位相或|
|~|按位取反|~8，将8的二进制形式按位取反|
|^|按位异或|10^6，将10和6的二进制形式按位异或|

相应的还有复合位运算符，形式参数复合算术运算符。


### 3.自增/自减运算符

这类运算符将某个变量自动加1或者减1。

|运算符|说明|
--------|-------
|++variable|先将variable的值加1，再赋给variable|
|--variable|先将variable的值减1，再赋给variable|
|variable++|先使用variable的值，再将该变量的值加1|
|variable--|先使用variable的值，再将该变量的值减1|

**前置运算符**都是先执行运算，然后再使用变量的值

**后置运算符**都是先使用变量的值，然后再执行运算

### 4.数字常量的进制

默认情况下，Shell总是以十进制来表示数字，用户也可以在Shell中使用其他的进制来表示数字。

有两种方法：
* 增加前缀：以0开头的数字表示8进制，以0x开头的数字表示16进制
* 使用井号#：例如2#1000表示2进制，8#42表示8进制

