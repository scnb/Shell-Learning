变量和引用
=============

# 1. 什么是变量

变量就是程序设计语言中的一个可以变化的量，并且，变化的是**变量的值**。

本质上讲，变量就是在程序中保存用户数据的一块内存空间，而变量名就是这块内存空间的地址。

在Shell中，变量名可以由字母、数字、下划线组成，并且只能以字母或者下划线开头。

在Shell语言中，变量名的大小写是敏感的。

### 变量的类型

#### 静态类型语言

静态类型语言是在程序的编译期间就确定变量类型的语言。
在这种语言中使用变量时，必须首先声明其类型。

#### 动态类型语言

动态设计语言是在程序的执行过程中才确定变量的数据类型的语言。
变量的数据类型根据第一次赋给该变量的值的数据类型来确定。

#### 强类型语言

强类型语言要求用户在定义变量时必须明确指定其数据类型。
数据类型之间的转换十分重要。

#### 弱类型语言

弱类型语言不要求用户明确指定变量的数据类型。
变量的数据类型之间的转换也无需明确进行。

Shell是一种**动态类型语言**和**弱类型语言**，即在Shell中，变量的数据类型无需显示的声明，变量的数据类型会根据不同的操作有所变化。

### 变量的定义

在Shell中，通常情况下用户可以直接使用变量，无需先进行定义。

为了更好的控制变量的相关属性，bash提供了名称为declare的命令来声明变量。

语言如下：

    declare attribute variable

attribute表示变量的属性：

* -p: 显示所有变量的值
* -i:   将变量定义为整数。如果求值失败或不是整数，就设置为0
* -r:   将变量声明为只读变量。不允许修改，也不允许删除
* -a:   将变量声明为数组变量。在某种意义上，所有变量都是数组，赋值给没有下标的标量与赋值给下标为0的数组元素相同。
* -f:   显示所有自定义函数，包括名称和函数体
* -x:   将变量设置成环境变量。在随后的脚本和程序中可以使用

### 变量和引号

Shell语言中一共有3种引号，分别为：单引号('')、双引号("")和反引号(``)。

1. 单引号括起来的字符都作为普通字符
2. 双引号括起来的字符，除"$"、"\"、“’”、“"”几个字符仍是特殊字符并保留其特殊功能外，其余字符仍作为普通字符对待。
3. 反引号括起来的字符串被Shell解释为命令。

反引号执行时，Shell首先执行该命令，然后以它的标准输出结果取代整个反引号（包括两个反引号部分）。

例如：

    echo "current directory is `pwd`"

输出：current directory is /home/neuqsc/文档
Shell/Chapter3

### 变量的作用域

Shell中的变量也分为全局变量和局部变量。

#### 1.全局变量

全局变量是使用范围比较大的变量。可以在脚本中定义，也可以在函数中定义。

在**脚本中定义**的变量都是全局变量，其作用域从被定义的地方开始，一直到Shell脚本结束或者被显示的删除。

在脚本中定义的变量不仅可以在脚本中直接使用，还可以在函数内部直接使用。

在**函数内部定义**的变量默认情况下也是全局变量，其作用域从函数被调用时执行变量定义的地方开始，一直到Shell脚本结束或者被显示的删除为止。

**但是，函数的参数是局部变量**

#### 2.局部变量

局部变量的使用范围较小，通常仅限于某个程序段访问，例如函数内部。

在Shell语言中，可以在函数内部通过**local关键字**定义局部变量。

另外，函数参数也是局部变量。

## **特殊情况**：

如果用户在函数外部定义了一个全局变量，在函数内部又定义了一个同名的局部变量，则在**调用该函数**时，函数内部的局部变量会屏蔽函数外部的全局变量。

即在出现同名的情况下，函数内部的局部变量优先级更高。

_需要说明一下_：Shell变量中的符号“$”表示取变量的值，只有再取值的时候才用到。

实际上，Shell中变量的原型为${var}，常用的$var只是一个简写，但是有时简写形式会导致错误。


### 系统变量

Shell语言的系统变量主要在对**参数判断**和**命令返回值判断**时使用，包括脚本和函数的参数，以及脚本和函数的返回值。

Shell中常用的系统变量：

* $n   表示第几个参数
* $#   命令行参数的个数
* $0    当前Shell脚本的名称
* $?    前一个命令/函数的返回状态码
* $*    以“参数1 参数2 ……”的形式将有所参数通过一个**字符串**返回
* $@    以“参数1” “参数2” ……的形式返回每个参数
* $$    返回本进程的ID（PID）

### 环境变量

Shell的**环境变量**就是**所有Shell程序**都可以使用的变量。

Shell程序在执行时，都会接受一组变量，这组变量就是环境变量。

环境变量会影响到所有脚本的执行结果。

用户如果想要使用环境变量，则可以通过相应的变量名来获取。

按照管理，Shell中的环境变量全部使用**大写字母**来表示。

# 2.变量赋值和清空

### 变量赋值

在Shell语言中，通常情况下变量并不需要专门的定义和初始化语言。

一个没有初始化的Shell变量被认为是一个空字符串。

在Shell中，赋值语句如下：

    variable_name=value

variable_name表示变量的名字，而value表示要赋给变量的值

**注意**：等号两边不能有空格，否则将被视为命令。

### 引用（使用）变量的值

用户可以通过在变量名前加上“$”来获取该变量的值。

例如：

    v1=Linux
    v2='RedHat Linux'
    v3="RedHat Linux $HOSTTYPE"
    v4=12345

    echo "$v1"
    echo "$v2"
    echo "$v3"
    echo "$v4"

### 清除变量

当某个Shell变量不再需要时，可以将其清除。当变量被清除后，其所代表的值也将消失。

清除变量是用unset语句，语法如下：

    unset variable_name

variable_name表示变量的名字。

# 3.引用和替换

### 引用

引用，是指将字符串用**引用符号**包括起来，以防止其中的特殊字符被Shell解释成其他涵义。

**特殊字符**是指除了字面意思外还可以解释成其他意思的字符。

例如：

    ll ex*
    ll "ex*"

上面两个语句的执行效果完全不同：

1. 第一条语句中星号作为通配符，寻找当前文件夹中所有以ex开头的文件

2. 第二条语句使用双引号将字符串括起来，ll命令会将ex*作为一个普通文件的名字来对待。

在Shell中，一共有4中引用符号：

* 双引号：除美元符号外、单引号、双引号和反斜线之外，其他所有的字符都将保持字面含义

* 单引号：所有的字符都将保持字面含义

* 反引号：反引号中的字符串将被解释为shell命令

* 反斜线：转义字符，屏蔽后的字符的特殊意义

### 全引用

当一个字符串被单引号括起来之后，其中所有的字符，除单引号之外都将被解释成为字面意思，即字符本身的含义。

这意味着被单引号括起来的所有字符都将被解释为普通的字符。

上面的这种引用方式称为**全引用**。

### 部分引用

对于使用双引号括起来的字符串，除美元符号、反引号以及反斜线之外的所有其他字符，都将被解释为字面意义，这称为**部分引用**。

即，在部分引用中，"$","`"和“\"仍然拥有特殊的含义。

### 命令替换

命令替换，是指在Shell程序中，将某个Shell命令的执行结果赋值给某个变量。

在bash种，有两种语法可以进行命令替换，分别为使用反引号和圆括号：

1. `shell_command`
2. $(shell_command)

### 转义

转义的作用就是转换某些特殊字符的意义。

转义使用反斜线表示，当反斜线后面的一个字符具有特殊的意义时，反斜线将屏蔽该字符的特殊意义，使得Shell按照该字符的字面意义来解释。

例如：

    echo \$variable_name

将输出 $variable_name